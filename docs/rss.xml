<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>ITVOP</title>
        <link>https://itvop.com</link>
        <description>Hi, this is Nicholas Lee, this site is my personal blog, I'm a Full-Stack developer over 9 years, I'd like to sharing more and more anything here.</description>
        <lastBuildDate>Tue, 12 May 2020 09:52:03 GMT</lastBuildDate>
        <docs>http://blogs.law.harvard.edu/tech/rss</docs>
        <generator>awesome</generator>
        <language>en</language>
        <image>
            <title>ITVOP</title>
            <url>https://itvop.com/images/logo.png</url>
            <link>https://itvop.com</link>
        </image>
        <copyright>All rights reserved 2020, Nicholas Lee</copyright>
        <atom:link href="https://itvop.com/atom.xml" rel="self" type="application/rss+xml"/>
        <item>
            <title><![CDATA[100th days after the twins was born]]></title>
            <link>https://itvop.com/10_hundred_days.html</link>
            <guid>https://itvop.com/10_hundred_days.html</guid>
            <pubDate>Mon, 11 May 2020 16:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="/static/img/hundred_days_1.jpg" alt="full"></p>
<p>Today is 100th days after the twins was born, the average weight of the two babies is about 5.5 kg.</p>
<p>Each time they can eatting about 100ml, most time they are sleeping,  a few hours for eatting and playing one day.</p>
<p>One important point: Their eyes can catch me now.</p>
]]></description>
            <content:encoded><![CDATA[<p><img src="/static/img/hundred_days_1.jpg" alt="full"></p>
<p>Today is 100th days after the twins was born, the average weight of the two babies is about 5.5 kg.</p>
<p>Each time they can eatting about 100ml, most time they are sleeping,  a few hours for eatting and playing one day.</p>
<p>One important point: Their eyes can catch me now.</p>
<p><img src="/static/img/hundred_days_2.jpg" alt="full"></p>
<p><img src="/static/img/hundred_days_3.jpg" alt="full"></p>
<p><img src="/static/img/hundred_days_4.jpg" alt="full"></p>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
            <enclosure url="https://itvop.com/static/img/hundred_days_1.jpg"/>
        </item>
        <item>
            <title><![CDATA[Take twins go home from hospital today]]></title>
            <link>https://itvop.com/9_take_babies_home_today.html</link>
            <guid>https://itvop.com/9_take_babies_home_today.html</guid>
            <pubDate>Mon, 10 Feb 2020 16:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="/static/img/babies_go_home.jpg" alt="full"></p>
<p>Waited for nine days, I got a call from the hospital, they tell me I can take my twins go home today.</p>
<p>My wife and I are very happy for that, We'll see our babies for the first times after they were born.</p>
<p>Finally, we taked them at twelve o'clcok, it’s so happiness!</p>
]]></description>
            <content:encoded><![CDATA[<p><img src="/static/img/babies_go_home.jpg" alt="full"></p>
<p>Waited for nine days, I got a call from the hospital, they tell me I can take my twins go home today.</p>
<p>My wife and I are very happy for that, We'll see our babies for the first times after they were born.</p>
<p>Finally, we taked them at twelve o'clcok, it’s so happiness!</p>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
            <enclosure url="https://itvop.com/static/img/babies_go_home.jpg"/>
        </item>
        <item>
            <title><![CDATA[My twins was born today]]></title>
            <link>https://itvop.com/8_my_babies_was_born_today.html</link>
            <guid>https://itvop.com/8_my_babies_was_born_today.html</guid>
            <pubDate>Sun, 02 Feb 2020 16:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="/static/img/new_life.jpg" alt="full"></p>
<p>I'd like to tell everybody good news: My twins were born today!!!</p>
<p>Yeah, they both are boys...., from now on I’ll be a real DADDY.</p>
<p>Unfortunately I can't see them until they get out from infant incubator, I wish two babies getting better and better as soon as posible.</p>
]]></description>
            <content:encoded><![CDATA[<p><img src="/static/img/new_life.jpg" alt="full"></p>
<p>I'd like to tell everybody good news: My twins were born today!!!</p>
<p>Yeah, they both are boys...., from now on I’ll be a real DADDY.</p>
<p>Unfortunately I can't see them until they get out from infant incubator, I wish two babies getting better and better as soon as posible.</p>
<p>Thanks my wife Alice Guo all my life!</p>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
            <enclosure url="https://itvop.com/static/img/new_life.jpg"/>
        </item>
        <item>
            <title><![CDATA[Rust how import a module]]></title>
            <link>https://itvop.com/7_rust_how_import_a_module.html</link>
            <guid>https://itvop.com/7_rust_how_import_a_module.html</guid>
            <pubDate>Thu, 12 Mar 2020 16:00:00 GMT</pubDate>
            <description><![CDATA[<p>Sometimes, we won't write a lot of code into one file, the better way is split the code into multiple files.</p>
<p>So, all the another files we call it modules, now we encounter a problem: How import a module to where we wanna use it?</p>
<p>That's very easiest in Rust, just use ‘mod’ keyword to do it.</p>
]]></description>
            <content:encoded><![CDATA[<p>Sometimes, we won't write a lot of code into one file, the better way is split the code into multiple files.</p>
<p>So, all the another files we call it modules, now we encounter a problem: How import a module to where we wanna use it?</p>
<p>That's very easiest in Rust, just use ‘mod’ keyword to do it.</p>
<p>math.rs</p>
<pre class="hljs"><code class="rust"><span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">sum</span></span>(a: <span class="hljs-built_in">u32</span>, b: <span class="hljs-built_in">u32</span>) -&gt; <span class="hljs-built_in">u32</span> {
  <span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<p>main.rs</p>
<pre class="hljs"><code class="rust"><span class="hljs-keyword">mod</span> math;

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
  <span class="hljs-built_in">println!</span>(<span class="hljs-string">"32 + 67 = {}"</span>, math::sum(<span class="hljs-number">32</span>, <span class="hljs-number">67</span>));
}
</code></pre>
<p>Don't forget add <code>pub</code> before <code>fn</code> to declare it that is a public function, that mean is it allow another module can be use this function. if the module name very long e.g <code>Math Lib</code>, so you can't use Camel-Case like this <code>mathLib</code>, we only just use Snake-Csae such as <code>math_lib</code></p>
<p>math_lib.rs</p>
<pre class="hljs"><code class="rust"><span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">sum</span></span>(a: <span class="hljs-built_in">u32</span>, b: <span class="hljs-built_in">u32</span>) -&gt; <span class="hljs-built_in">u32</span> {
  <span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<p>main.rs</p>
<pre class="hljs"><code class="rust"><span class="hljs-keyword">mod</span> math_lib;

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
  <span class="hljs-built_in">println!</span>(<span class="hljs-string">"32 + 67 = {}"</span>, math_lib::sum(<span class="hljs-number">32</span>, <span class="hljs-number">67</span>));
}
</code></pre>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
        </item>
        <item>
            <title><![CDATA[Anuglar8 error ngModel isn't a known property]]></title>
            <link>https://itvop.com/6_angular8_error_ngmodel_is_not_a_known_property.html</link>
            <guid>https://itvop.com/6_angular8_error_ngmodel_is_not_a_known_property.html</guid>
            <pubDate>Sun, 15 Dec 2019 16:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="/static/img/angular8.jpg" alt="nginx"></p>
<p>My team use Angular1 a few years ago, it's really so good for my team at that time, but the  many features of Angular2 makes developer of my team is hard to leaning. finally, we have to take the React instead of Angular2.</p>
<p>Today, I'm take the Angular8 again for one project.</p>
]]></description>
            <content:encoded><![CDATA[<p><img src="/static/img/angular8.jpg" alt="nginx"></p>
<p>My team use Angular1 a few years ago, it's really so good for my team at that time, but the  many features of Angular2 makes developer of my team is hard to leaning. finally, we have to take the React instead of Angular2.</p>
<p>Today, I'm take the Angular8 again for one project.</p>
<p>Unfortunately, I got a error when I using a radio. the error like this:</p>
<blockquote>
<p>Can't bind to 'ngModel' since it isn't a known property of 'mat-radio-group'.</p>
</blockquote>
<p>It tells me the ngModel isn't a known property, Am I missing something? I chack it that again and again, there is nothing error in my code I think.</p>
<p>But isn't really working now, finally, I got the error reason from Stack Overflow, It needs import the FormsModule in module before using the ngModel property.</p>
<pre class="hljs"><code class="javascript"><span class="hljs-keyword">import</span> { FormsModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;

@NgModule({
  ...
  imports: [
    ...
    FormsModule,
    ...
  ]
  ...
})
</code></pre>
<p>Now, the ngModel property working now.</p>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
            <enclosure url="https://itvop.com/static/img/angular8.jpg"/>
        </item>
        <item>
            <title><![CDATA[Java compile code too large]]></title>
            <link>https://itvop.com/5_java_compile_code_too_large.html</link>
            <guid>https://itvop.com/5_java_compile_code_too_large.html</guid>
            <pubDate>Sun, 08 Dec 2019 16:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="/static/img/java_funny.jpg" alt="nginx"></p>
<p>I'm new to Java, but today I need to deploy a jar package of i18n to Maven repositry for some guys of company to use. the i18n.json file it looks like this:</p>
<p>i18n.json</p>
<pre class="hljs"><code class="json">{
  <span class="hljs-attr">"NAME"</span>: {
    <span class="hljs-attr">"zh"</span>: <span class="hljs-string">"名字"</span>,
    <span class="hljs-attr">"en"</span>: <span class="hljs-string">"Name"</span>
  },

  <span class="hljs-attr">"AGE"</span>: {
    <span class="hljs-attr">"zh"</span>: <span class="hljs-string">"年龄"</span>,
    <span class="hljs-attr">"en"</span>: <span class="hljs-string">"Age"</span>
  }
}
</code></pre>
]]></description>
            <content:encoded><![CDATA[<p><img src="/static/img/java_funny.jpg" alt="nginx"></p>
<p>I'm new to Java, but today I need to deploy a jar package of i18n to Maven repositry for some guys of company to use. the i18n.json file it looks like this:</p>
<p>i18n.json</p>
<pre class="hljs"><code class="json">{
  <span class="hljs-attr">"NAME"</span>: {
    <span class="hljs-attr">"zh"</span>: <span class="hljs-string">"名字"</span>,
    <span class="hljs-attr">"en"</span>: <span class="hljs-string">"Name"</span>
  },

  <span class="hljs-attr">"AGE"</span>: {
    <span class="hljs-attr">"zh"</span>: <span class="hljs-string">"年龄"</span>,
    <span class="hljs-attr">"en"</span>: <span class="hljs-string">"Age"</span>
  }
}
</code></pre>
<p>In fact, all the keys in a large number in i18n.json file, maybe about ten thousands of the keys. I wanna provide a Enum of Java to including all the keys of i18n.json, the Enum can easiest for the developers to get what fully name of key they want it by the IDE auto-complete assistant.</p>
<p>i18n.java</p>
<pre class="hljs"><code class="java"><span class="hljs-keyword">package</span> com.example;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">i18n</span> </span>{
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> Keys {
    NAME,
    AGE,
    ...
  },

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">get</span><span class="hljs-params">(Keys key)</span> </span>{
    ...
  }
}
</code></pre>
<p>usage</p>
<pre class="hljs"><code class="java"><span class="hljs-keyword">package</span> com.example;

<span class="hljs-keyword">import</span> com.example.i18n;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestI18n</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">testGet</span><span class="hljs-params">()</span> </span>{
    I18n.get(i18n.Keys.NAME); <span class="hljs-comment">// return: Name</span>
    I18n.get(i18n.Keys.AGE); <span class="hljs-comment">// return: Age</span>
  }
}
</code></pre>
<p>Yes, I feel that's a good idea, using enum type as key can avoid the wrong name such as string type in runtime. So I read all the keys from i18n.json file and generated a  java source file by a Python script.  in the java source file, it has a about ten thousands items of enum type in a  named Keys variable, then I'd like to compile that Java source code by a command <code>mvn deploy</code>.</p>
<p>Unfortunately, it was failed.</p>
<p>I got the keywords <code>code too large</code> from the failed compile stdout. What is that meaning?</p>
<p>Finally, I'm understand it from Google search, it means is the JVM force restrict a single method in a Java class may be at most 64KB of bytecode.</p>
<p>Eventually, I'm gave up Enum type and have to using the String as Key of i18n, if you have a good way for me please let me know.</p>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
            <enclosure url="https://itvop.com/static/img/java_funny.jpg"/>
        </item>
        <item>
            <title><![CDATA[Using the proxy_redirect module to replace the field Location in response's header on Nginx]]></title>
            <link>https://itvop.com/4_nginx_proxy_redirect_replace_location_field_in_header.html</link>
            <guid>https://itvop.com/4_nginx_proxy_redirect_replace_location_field_in_header.html</guid>
            <pubDate>Wed, 27 Nov 2019 16:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="/static/img/nginx_logo.jpg" alt="nginx"></p>
<p>One product of my company is a internal system for business guests, it's deploy into a local network in the most time, using Nginx do as reverse proxy on server for a longtime, everybody can be access it by IP address of nginx,  the most uses caces it'll be working well done anytime, you don't worry it.</p>
]]></description>
            <content:encoded><![CDATA[<p><img src="/static/img/nginx_logo.jpg" alt="nginx"></p>
<p>One product of my company is a internal system for business guests, it's deploy into a local network in the most time, using Nginx do as reverse proxy on server for a longtime, everybody can be access it by IP address of nginx,  the most uses caces it'll be working well done anytime, you don't worry it.</p>
<p>One day, a customer wants access server by the internet, they open a port on Firewall and forward in to a nginx, that nginx deployed in a same local network and proxy pass all the requests to our nginx.</p>
<p>But there is a problem in it, our server always response an IP address of local network as field value of Location in header when in 301/302 cases. The users on the internet can't keep access our server by an IP address of local network. here is the status:</p>
<p><img src="/static/img/nginx_proxy_redirect_and_proxy_pass.jpg" alt="full"></p>
<p>Fortunately, there is a simplest way to support it in a light change. this is the module <code>proxy_redirect</code> of nginx, we can easiest replace the local network IP address with an internet IP address by the module. just like this</p>
<pre class="hljs"><code class="nginx"><span class="hljs-section">server</span> {
  <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;

  <span class="hljs-attribute">location</span> / {
    <span class="hljs-attribute">proxy_pass</span> http://192.168.1.2;
    <span class="hljs-attribute">proxy_redirect</span> http://192.168.1.2 https://itvop.com;
  }
}
</code></pre>
<p>Since reload nginx with the config, our server can support both the local network and internet access at the same time.</p>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
            <enclosure url="https://itvop.com/static/img/nginx_logo.jpg"/>
        </item>
        <item>
            <title><![CDATA[A bad day from upgrading the Etcd for my Kubernetes cluster]]></title>
            <link>https://itvop.com/3_a_bad_day_from_uprading_the_etcd_for_kubernetes.html</link>
            <guid>https://itvop.com/3_a_bad_day_from_uprading_the_etcd_for_kubernetes.html</guid>
            <pubDate>Sun, 24 Nov 2019 16:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="/static/img/bad_day.jpg" alt="bad day"></p>
<p>I said there is few problems in my Kubernetes when I upgraded it a week ago, here is the that post's link <a href="/2_how_to_upgrade_k8s.html">How to upgrade Kubernetes cluster</a>, one of problem is the Completed status of CronJob's pods can't auto clean even I set up <code>successfulJobsHistoryLimit: 3</code> for it.</p>
]]></description>
            <content:encoded><![CDATA[<p><img src="/static/img/bad_day.jpg" alt="bad day"></p>
<p>I said there is few problems in my Kubernetes when I upgraded it a week ago, here is the that post's link <a href="/2_how_to_upgrade_k8s.html">How to upgrade Kubernetes cluster</a>, one of problem is the Completed status of CronJob's pods can't auto clean even I set up <code>successfulJobsHistoryLimit: 3</code> for it.</p>
<p>I knew that error is on the Etcd not Kubernetes after upgraded in a couple days,  So I want to upgrading the Etcd. There is a shell script file in my VM for a long time. It's wirtten for my build the Kubernetes one year ago</p>
<pre class="hljs"><code class="shell"><span class="hljs-meta">#</span><span class="bash">!/bin/sh</span>
mkdir -p /var/etcd
docker rm etcd1 -f
rm -rf /var/etcd
docker run --restart=always --net host -it --name etcd1 -d \
-v /var/etcd:/var/etcd \
-v /etc/localtime:/etc/localtime \
k8s.gcr.io/etcd:3.3.10 \
etcd --name etcd-s1 \
--auto-compaction-retention=1 --max-request-bytes=33554432 --quota-backend-bytes=8589934592 \
--data-dir=/var/etcd/etcd-data \
--listen-client-urls http://0.0.0.0:2379 \
--listen-peer-urls http://0.0.0.0:2380 \
--initial-advertise-peer-urls http://node4.cluster.local:2380 \
--advertise-client-urls http://node4.cluster.local:2379,http://node4.cluster.local:2380 \
-initial-cluster-token etcd-cluster \
-initial-cluster "etcd-s1=http://node4.cluster.local:2380,etcd-s2=http://node5.cluster.local:2380,etcd-s3=http://node6.cluster.local:2380" \
-initial-cluster-state new
</code></pre>
<p>I'm just change the <code>k8s.gcr.io/etcd:3.3.10</code> to <code>k8s.gcr.io/etcd:3.3.15-0</code> and running it at once. Oh, I sure I was so stupid at that momment. I have no note that <code>rm -rf /var/etcd</code> and some initial arguments for etcd in last like <code>-initial-cluster-state new</code>.</p>
<p>There is ruinous for my Kubernetes cluster, All the service、pod were losed. I can't do anything when I catch it, because I dit not backup the data of etcd before upgrade. So I got it there is a only way for me: rebuild a Kubernetes cluster and recover all of deploy, service, ingress!</p>
<p>It's a overtime work for me, I must be to do it as soon as posible when all the emails starting comes to me after the Kubernetes not working an hour. It took me a long time, I'm thinking about it</p>
<ul>
<li>Why not choice the internal Etcd cluster for Kubernetes? the most time it will be more relable than external.</li>
<li>Why am I upgrading in no back up data?</li>
<li>Why I did no read the shell scripts in detial when I running it?</li>
</ul>
<p>Yes, it's my mistake, never do it again I told myself, I don't want to keep stupid all my life.</p>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
            <enclosure url="https://itvop.com/static/img/bad_day.jpg"/>
        </item>
        <item>
            <title><![CDATA[How to upgrade Kubernetes cluster]]></title>
            <link>https://itvop.com/2_how_to_upgrade_kubernetes_cluster.html</link>
            <guid>https://itvop.com/2_how_to_upgrade_kubernetes_cluster.html</guid>
            <pubDate>Sun, 17 Nov 2019 16:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="/static/img/kubernetes_logo.png" alt="kubernetes"></p>
<p>You don't need to upgrade the Kubernetes cluster in most time, there is no reason to upgrading if they running in stable, sometime we need to upgrade it for some bugs fixed and features. If you already have a running cluster and you want to upgrade it, there are three steps of work to do.</p>
]]></description>
            <content:encoded><![CDATA[<p><img src="/static/img/kubernetes_logo.png" alt="kubernetes"></p>
<p>You don't need to upgrade the Kubernetes cluster in most time, there is no reason to upgrading if they running in stable, sometime we need to upgrade it for some bugs fixed and features. If you already have a running cluster and you want to upgrade it, there are three steps of work to do.</p>
<h2>Step 1: Get the upgrade plan</h2>
<p>You should get the upgrade plan with kubeadm command, run below command in one of master nodes to get the upgrade plan</p>
<pre class="hljs"><code class="shell">kubeadm upgrade plan
</code></pre>
<p>You should see something in stdout including like <code>You can now apply the upgrade by executing the following command</code> aflter you run it, it will list all the avaliable plan for upgrade at once. For example, here is in my case</p>
<pre class="hljs"><code class="shell">node4 ~ # kubeadm upgrade plan
[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster...
[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade] Fetching available versions to upgrade to
[upgrade/versions] Cluster version: v1.16.2
[upgrade/versions] kubeadm version: v1.16.2
[upgrade/versions] Latest stable version: v1.16.3
[upgrade/versions] Latest version in the v1.16 series: v1.16.3

External components that should be upgraded manually before you upgrade the control plane with 'kubeadm upgrade apply':
COMPONENT   CURRENT   AVAILABLE
Etcd        3.3.10    3.3.15-0

Components that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':
COMPONENT   CURRENT        AVAILABLE
Kubelet     15 x v1.16.2   v1.16.3

Upgrade to the latest version in the v1.16 series:

COMPONENT            CURRENT   AVAILABLE
API Server           v1.16.2   v1.16.3
Controller Manager   v1.16.2   v1.16.3
Scheduler            v1.16.2   v1.16.3
Kube Proxy           v1.16.2   v1.16.3
CoreDNS              1.6.2     1.6.2

You can now apply the upgrade by executing the following command:

        kubeadm upgrade apply v1.16.3

Note: Before you can perform this upgrade, you have to update kubeadm to v1.16.3.
</code></pre>
<p>If there is a plan of the available list you want to continue, please, move the step 2</p>
<h2>Step 2: Download the kubeadm</h2>
<p>You will get a version from the upgrade plan, So we need to update kubeadm to the version, this work is just simplest, we can get the kubeadm from here: <img src="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/" alt="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">.</p>
<p>We keep going to Step 3 when you are get a binary of kubeadm.</p>
<h2>Step 3: Upgrading with kubeadm</h2>
<p>Now we can run a command which from Step 1 to got it to upgrade the cluster, For example, I'll upgrade my cluster from v1.16.2 to v1.16.3 in my case.</p>
<pre class="hljs"><code class="shell">node4 ~ # kubeadm upgrade apply v1.16.3
[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster...
[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade/version] You have chosen to change the cluster version to "v1.16.3"
[upgrade/versions] Cluster version: v1.16.2
[upgrade/versions] kubeadm version: v1.16.3
[upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y
[upgrade/prepull] Will prepull images for components [kube-apiserver kube-controller-manager kube-scheduler]
[upgrade/prepull] Prepulling image for component kube-scheduler.
[upgrade/prepull] Prepulling image for component kube-apiserver.
[upgrade/prepull] Prepulling image for component kube-controller-manager.
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-kube-controller-manager
[apiclient] Found 3 Pods for label selector k8s-app=upgrade-prepull-kube-apiserver
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler
[apiclient] Found 3 Pods for label selector k8s-app=upgrade-prepull-kube-controller-manager
[apiclient] Found 3 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler
[upgrade/prepull] Prepulled image for component kube-apiserver.
[upgrade/prepull] Prepulled image for component kube-controller-manager.
[upgrade/prepull] Prepulled image for component kube-scheduler.
[upgrade/prepull] Successfully prepulled the images for all the control plane components
[upgrade/apply] Upgrading your Static Pod-hosted control plane to version "v1.16.3"...
Static pod: kube-apiserver-node4 hash: 95960acc2c1b28de33ffa5714d927752
Static pod: kube-controller-manager-node4 hash: db76afd7d7adb4351dc71a27eaccae8b
Static pod: kube-scheduler-node4 hash: 74dea8da17aa6241e5e4f7b2ba4e1d8e
[upgrade/staticpods] Writing new Static Pod manifests to "/etc/kubernetes/tmp/kubeadm-upgraded-manifests234740264"
[upgrade/staticpods] Preparing for "kube-apiserver" upgrade
[upgrade/staticpods] Renewing apiserver certificate
[upgrade/staticpods] Renewing apiserver-kubelet-client certificate
[upgrade/staticpods] Renewing front-proxy-client certificate
[upgrade/staticpods] Moved new manifest to "/etc/kubernetes/manifests/kube-apiserver.yaml" and backed up old manifest to "/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-18-09-10-29/kube-apiserver.yaml"
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: kube-apiserver-node4 hash: 95960acc2c1b28de33ffa5714d927752
Static pod: kube-apiserver-node4 hash: 0a655ff3baac3464c9e8cecebd3e39ed
[apiclient] Found 3 Pods for label selector component=kube-apiserver
[upgrade/staticpods] Component "kube-apiserver" upgraded successfully!
[upgrade/staticpods] Preparing for "kube-controller-manager" upgrade
[upgrade/staticpods] Renewing controller-manager.conf certificate
[upgrade/staticpods] Moved new manifest to "/etc/kubernetes/manifests/kube-controller-manager.yaml" and backed up old manifest to "/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-18-09-10-29/kube-controller-manager.yaml"
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: kube-controller-manager-node4 hash: db76afd7d7adb4351dc71a27eaccae8b
Static pod: kube-controller-manager-node4 hash: 2691e4f51ee24e8c610557d2266dcbd5
[apiclient] Found 3 Pods for label selector component=kube-controller-manager
[upgrade/staticpods] Component "kube-controller-manager" upgraded successfully!
[upgrade/staticpods] Preparing for "kube-scheduler" upgrade
[upgrade/staticpods] Renewing scheduler.conf certificate
[upgrade/staticpods] Moved new manifest to "/etc/kubernetes/manifests/kube-scheduler.yaml" and backed up old manifest to "/etc/kubernetes/tmp/kubeadm-backup-manifests-2019-11-18-09-10-29/kube-scheduler.yaml"
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
Static pod: kube-scheduler-node4 hash: 74dea8da17aa6241e5e4f7b2ba4e1d8e
Static pod: kube-scheduler-node4 hash: 4e1bd6e5b41d60d131353157588ab020
[apiclient] Found 3 Pods for label selector component=kube-scheduler
[upgrade/staticpods] Component "kube-scheduler" upgraded successfully!
[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace
[kubelet] Creating a ConfigMap "kubelet-config-1.16" in namespace kube-system with the configuration for the kubelets in the cluster
[kubelet-start] Downloading configuration for the kubelet from the "kubelet-config-1.16" ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[addons]: Migrating CoreDNS Corefile
[addons] Applied essential addon: CoreDNS
[endpoint] WARNING: port specified in controlPlaneEndpoint overrides bindPort in the controlplane address
[addons] Applied essential addon: kube-proxy

[upgrade/successful] SUCCESS! Your cluster was upgraded to "v1.16.3". Enjoy!

[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.
</code></pre>
<p>If you could see like <code>[upgrade/successful] SUCCESS! Your cluster was upgraded to &quot;vX.X.X&quot;. Enjoy!</code> in the last stdout, it has been done for upgrade!</p>
<h2>Notes</h2>
<p>There is a easy to make mistakes just only downloaing the kubeadm, you will see the new version by the command <code>kubectl get nodes</code> after downloaded the kubeadm, kubectl and kubelet for all the nodes. In fact, it really not a new version for working, You have to run command <code>kubeadm upgrade apply vX.X.X</code> for the last step.</p>
<p>The new versions of Kubernetes isn't stable, this is a the most important. I have heavy pay for it, I upgrade my cluster tow months ago, there are tow problems I can't do something for it for a long time.</p>
<ul>
<li>1、The Pods of Complated status isn't auto remove, But it always keep last three pods of Complated status in older version. For now, I doing by the Crontab</li>
<li>2、The containers of Gitlab-Runner exit with code 137 even I given it enough Memory and CPU in sometime, here is my opened's issue: <img src="https://gitlab.com/gitlab-org/charts/gitlab-runner/issues/114" alt="https://gitlab.com/gitlab-org/charts/gitlab-runner/issues/114"></li>
</ul>
<h2>Updated in November 28, 2019</h2>
<p>About the Pods of Complated status isn't auto clean on the CronJob, I have been find out what is happing. it don't matter with Kubernetes, it's on the Etcd, it's version too old dons’t support the latest Kubernetes versions. I’m fixed that by upgrade the Etcd to the latest version.</p>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
            <enclosure url="https://itvop.com/static/img/kubernetes_logo.png"/>
        </item>
        <item>
            <title><![CDATA[Welcome]]></title>
            <link>https://itvop.com/1_welcome.html</link>
            <guid>https://itvop.com/1_welcome.html</guid>
            <pubDate>Tue, 05 Nov 2019 16:00:00 GMT</pubDate>
            <description><![CDATA[<p><img src="/static/img/new_start.jpg" alt="full"></p>
<h2>About me</h2>
<p>Hello, this is Nicholas Lee, I'm a Chinese and 32 years old this year. I'm hot for coding and coding for a living, I have over 9 years coding experience in Web Development, I be at a IT company's Full-Stack developer in Peking now.</p>
]]></description>
            <content:encoded><![CDATA[<p><img src="/static/img/new_start.jpg" alt="full"></p>
<h2>About me</h2>
<p>Hello, this is Nicholas Lee, I'm a Chinese and 32 years old this year. I'm hot for coding and coding for a living, I have over 9 years coding experience in Web Development, I be at a IT company's Full-Stack developer in Peking now.</p>
<h2>About the website</h2>
<p>Here's my personal website, I'd like to sharing more and more about coding skills here, of course I'd like sharing interesting thing about China sometime, too.</p>
<p>You can focus me by the website, <a href="https://github.com/lizhongit">Github</a> and <a href="https://twitter.com/lizhongit">Twitter</a> if you want. I'll be happy to know you, maybe we could be a good friends in the future.</p>
<p>If you have a plan to traveling China, I'll be happy to give you more infomation about China as I can.</p>
<p>Because I'm a new guy in English, anything like grammar and words maybe wrong if you see, please help me.</p>
<p>Thanks everybody!</p>
]]></content:encoded>
            <author>lizhongit@gmail.com (Nicholas Lee)</author>
            <enclosure url="https://itvop.com/static/img/new_start.jpg"/>
        </item>
    </channel>
</rss>